webpackJsonp([20],{RZ8s:function(t,e){},sdn3:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("mvHQ"),r=a.n(n),i=a("ptRb"),l={data:function(){return{BMap:null,map:null,toA:!0,toB:!0,startDate:new Date("2019-12-09 00:00:00"),endDate:new Date("2019-12-09 03:50:00"),companies:[],selectedCompany:"",cars:[],selectedCar:"",playbackRate:1,zoom:15,center:{lng:116.404,lat:39.915},currentRow:null,trail:[],polylinePath:[],showingCar:"",markerPoint:{},rotation:0,index:0,timer:null,loading:!1,companiesAndCars:[]}},created:function(){var t=this;Object(i.G)(!1).then(function(e){for(var a=JSON.parse(r()(e.data.respBody)),n=0;n<a.length;++n)a[n].carCompanyName&&function(){var e=a[n],l=e.carCompanyID,s=e.carCompanyName;t.companies.push({id:l,name:s}),Object(i.Q)(s,!1).then(function(e){var a=JSON.parse(r()(e.data.respBody));t.companiesAndCars.push({companyId:l,companyName:s,cars:a})})}()});var e=new Date,a=e.getFullYear(),n=e.getMonth()+1,l=e.getDate()-5,s=e.getHours(),o=e.getMinutes(),c=e.getSeconds(),d=a+"-"+n.toString().padStart(2,"0")+"-"+l.toString().padStart(2,"0")+" "+s.toString().padStart(2,"0")+":"+o.toString().padStart(2,"0")+":"+c.toString().padStart(2,"0"),h=a+"-"+n.toString().padStart(2,"0")+"-"+(l+1).toString().padStart(2,"0")+" "+s.toString().padStart(2,"0")+":"+o.toString().padStart(2,"0")+":"+c.toString().padStart(2,"0");this.startDate=new Date(d),this.endDate=new Date(h)},beforeRouteLeave:function(t,e,a){clearInterval(this.timer),a()},watch:{},methods:{setCurrent:function(t){this.$refs.canvasTable.setCurrentRow(t)},handleCurrentChange:function(t){this.currentRow=t},map_handler:function(t,e){this.BMap=t,this.map=e},toggleA:function(){var t=document.getElementById("map"),e=document.getElementById("controlBar"),a=document.getElementById("toggleA");this.toA?(a.style.backgroundImage='url("../../../static/img/侧栏1.png")',e.style.width="ovw",t.style.width="82.76vw",this.toA=!1):(a.style.backgroundImage='url("../../../static/img/侧栏2.png")',e.style.width="15vw",t.style.width="66.021vw",this.toA=!0)},toggleB:function(){var t=document.getElementById("toggleB"),e=document.getElementById("historyTable");this.toB?(t.style.backgroundImage='url("../../../static/img/侧栏3.png")',t.style.bottom="30%",e.style.bottom="0%",this.toB=!1):(t.style.backgroundImage='url("../../../static/img/侧栏4.png")',t.style.bottom="0%",e.style.bottom="-30%",this.toB=!0)},changeCompany:function(t){if(""!==t){this.selectedCar="",this.cars=[];for(var e=0;e<this.companiesAndCars.length;++e)if(this.companiesAndCars[e].companyName==t)for(var a=this.companiesAndCars[e].cars,n=0;n<a.length;++n){var r=a[n],i=r.carId,l=r.carNo;this.cars.push({id:i,name:l})}}},changeSpeed:function(t){window.clearInterval(this.timer),this.run(t)},historialButoon:function(){var t=this;if(this.endDate.getDate()-this.startDate.getDate()>7)alert("请选择7天以内的时间段！");else{if(this.loading=!0,!this.selectedCar||!this.startDate||!this.endDate)return void alert("请完善查询信息！");this.resetAll();var e=this.$moment(this.startDate).format("YYYY-MM-DD HH:mm:ss"),a=this.$moment(this.endDate).format("YYYY-MM-DD HH:mm:ss");Object(i.S)(this.selectedCar,!1,e,a).then(function(e){t.showingCar=t.selectedCar;var a=JSON.parse(r()(e.data.respBody));if(a){t.trail=a;for(var n=0;n<t.trail.length;n++)t.trail[n].carno=t.selectedCar;for(var i=0,l=0,s=0;s<a.length;++s){var o=a[s],c=o.lon,d=o.lat,h=t.wgs2bd(d,c),m=h.lat,u=h.lng;i+=u,l+=m,t.polylinePath.push({lng:u,lat:m})}i/=a.length,l/=a.length,t.center={lng:i,lat:l},t.zoom=12,t.run(t.playbackRate),t.loading=!1}else alert("该时段无数据！"),t.loading=!1})}},resetAll:function(){window.clearInterval(this.timer),this.showingCar="",this.markerPoint={},this.polylinePath=[],this.index=0},getRotation:function(t,e){var a=e.lng-t.lng,n=e.lat-t.lat,r=a/n,i=Math.atan(r);return i=i/Math.PI*180,i-=n>=0?90:270},run:function(t){var e=this,a=e.$refs.canvasTable.bodyWrapper;this.timer=setInterval(function(){try{e.$refs.canvasTable.setCurrentRow(e.trail[e.index]);var t=e.index-1;a.children[0].rows[t]&&(a.scrollTop=a.children[0].rows[t].offsetTop),e.markerPoint=e.polylinePath[e.index],0===e.index?e.rotation=0:e.rotation=e.getRotation(e.polylinePath[e.index-1],e.polylinePath[e.index]),e.index===e.polylinePath.length-1&&window.clearInterval(e.timer),e.index++}catch(t){e.resetAll(),alert("该时段无数据！")}},1e3/t)},transformLat:function(t,e){var a=3.141592653589793,n=2*t-100+3*e+.2*e*e+.1*t*e+.2*Math.sqrt(Math.abs(t));return n+=2*(20*Math.sin(6*t*a)+20*Math.sin(2*t*a))/3,n+=2*(20*Math.sin(e*a)+40*Math.sin(e/3*a))/3,n+=2*(160*Math.sin(e/12*a)+320*Math.sin(e*a/30))/3},transformLon:function(t,e){var a=3.141592653589793,n=300+t+2*e+.1*t*t+.1*t*e+.1*Math.sqrt(Math.abs(t));return n+=2*(20*Math.sin(6*t*a)+20*Math.sin(2*t*a))/3,n+=2*(20*Math.sin(t*a)+40*Math.sin(t/3*a))/3,n+=2*(150*Math.sin(t/12*a)+300*Math.sin(t/30*a))/3},delta:function(t,e){var a=3.141592653589793,n=6378245,r=.006693421622965943,i=this.transformLat(e-105,t-35),l=this.transformLon(e-105,t-35),s=t/180*a,o=Math.sin(s);o=1-r*o*o;var c=Math.sqrt(o);return{lat:i=180*i/(n*(1-r)/(o*c)*a),lng:l=180*l/(n/c*Math.cos(s)*a)}},wgs2gcj:function(t,e){var a=this.delta(t,e);return{lat:t+a.lat,lng:e+a.lng}},gcj2bd:function(t,e){var a=52.35987755982988,n=e,r=t,i=Math.sqrt(n*n+r*r)+2e-5*Math.sin(r*a),l=Math.atan2(r,n)+3e-6*Math.cos(n*a),s=i*Math.cos(l)+.0065;return{lat:i*Math.sin(l)+.006,lng:s}},wgs2bd:function(t,e){var a=this.gcj2bd(t,e),n=this.wgs2gcj(a.lat,a.lng);return{lat:n.lat,lng:n.lng}}}},s={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"historicalTrack"}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{id:"map","element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"}},[a("baidu-map",{staticClass:"bm-view",attrs:{"scroll-wheel-zoom":!0,zoom:t.zoom,center:t.center},on:{ready:t.map_handler}},[a("bm-map-type",{attrs:{"map-types":["BMAP_NORMAL_MAP","BMAP_HYBRID_MAP"],anchor:"BMAP_ANCHOR_TOP_RIGHT"}}),t._v(" "),a("bm-scale",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT"}}),t._v(" "),a("bm-city-list",{attrs:{anchor:"BMAP_ANCHOR_BOTTOM_RIGHT"}}),t._v(" "),a("bm-navigation",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT"}}),t._v(" "),a("bm-polyline",{attrs:{path:t.polylinePath,"stroke-color":"red","stroke-opacity":.8,"stroke-weight":5,editing:!1}}),t._v(" "),a("bm-marker",{attrs:{position:t.markerPoint,rotation:t.rotation,title:t.showingCar,dragging:!1,icon:{url:"../../../static/img/bus_purple_s.png",size:{width:43,height:20},anchor:{width:21.5,height:10}}}})],1),t._v(" "),a("div",{attrs:{id:"toggleA"},on:{click:t.toggleA}}),t._v(" "),a("div",{attrs:{id:"toggleB"},on:{click:t.toggleB}}),t._v(" "),a("div",{attrs:{id:"historyTable"}},[a("el-table",{ref:"canvasTable",staticStyle:{width:"100%"},attrs:{data:t.trail,height:"250",border:"","highlight-current-row":""},on:{"current-change":t.handleCurrentChange}},[a("el-table-column",{attrs:{type:"index",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"terminalId",label:"轨迹编号",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"carno",label:"车牌号",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"speed",label:"速度",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"lon",label:"经度",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"lat",label:"纬度",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"uptime",label:"采集时间",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n            "+t._s(t._f("dateFormat")(e.row.uptime))+"\n          ")]}}])})],1)],1)],1),t._v(" "),a("div",{attrs:{id:"controlBar"}},[a("p",[t._v("历史轨迹")]),t._v(" "),a("div",{attrs:{id:"selectTime"}},[t._m(0),t._v(" "),a("el-date-picker",{attrs:{type:"datetime","default-value":"",placeholder:"选择开始时间",size:"small"},model:{value:t.startDate,callback:function(e){t.startDate=e},expression:"startDate"}}),t._v(" "),a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择结束时间",size:"small"},model:{value:t.endDate,callback:function(e){t.endDate=e},expression:"endDate"}})],1),t._v(" "),a("div",{attrs:{id:"selectCompany"}},[t._m(1),t._v(" "),a("el-select",{attrs:{placeholder:"请选择公司",filterable:"",size:"small"},on:{change:t.changeCompany},model:{value:t.selectedCompany,callback:function(e){t.selectedCompany=e},expression:"selectedCompany"}},t._l(t.companies,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.name}})}),1)],1),t._v(" "),a("div",{attrs:{id:"selectCar"}},[t._m(2),t._v(" "),a("el-select",{attrs:{placeholder:"请选择车辆",filterable:"",size:"small"},model:{value:t.selectedCar,callback:function(e){t.selectedCar=e},expression:"selectedCar"}},t._l(t.cars,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.name}})}),1),t._v(" "),a("el-button",{attrs:{id:"hitoricalButton",type:"primary",size:"small",round:""},on:{click:t.historialButoon}},[t._v("查询历史轨迹")])],1),t._v(" "),a("div",{attrs:{id:"selectSpeed"}},[t._m(3),t._v(" "),a("el-radio-group",{on:{change:t.changeSpeed},model:{value:t.playbackRate,callback:function(e){t.playbackRate=e},expression:"playbackRate"}},[a("el-radio",{attrs:{label:1}},[t._v("1x")]),t._v(" "),a("el-radio",{attrs:{label:2}},[t._v("2x")]),t._v(" "),a("el-radio",{attrs:{label:3}},[t._v("3x")]),t._v(" "),a("el-radio",{attrs:{label:4}},[t._v("4x")])],1)],1)])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"subTitle"},[e("i",{staticClass:"el-icon-caret-right",staticStyle:{color:"white"}}),this._v(" 时间选择")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"subTitle"},[e("i",{staticClass:"el-icon-caret-right",staticStyle:{color:"white"}}),this._v(" 公司选择")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"subTitle"},[e("i",{staticClass:"el-icon-caret-right",staticStyle:{color:"white"}}),this._v(" 车辆选择")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"subTitle"},[e("i",{staticClass:"el-icon-caret-right",staticStyle:{color:"white"}}),this._v(" 播放速度")])}]};var o=a("VU/8")(l,s,!1,function(t){a("uHbU"),a("RZ8s")},"data-v-44fc7396",null);e.default=o.exports},uHbU:function(t,e){}});
//# sourceMappingURL=20.822f32dc7d218b752568.js.map